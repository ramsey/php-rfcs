====== PHP RFC: E_NOTICE for invalid container array-access ======
  * Version: 0.1
  * Date: 2016-07-27
  * Author: David Walker (dave@mudsite.com)
  * Status: Draft
  * First Published at: http://wiki.php.net/rfc/notice-for-non-valid-array-container

===== Introduction =====
PHP current array-access system works very well when attempting to access containers of type array, reference(to an array), and objects that implement ArrayAccess.  However, accessing elements not of those types results in a NULL value returned without any alert as to why it's null.  This feature has been requested in [[https://bugs.php.net/bug.php?id=37676|37676]] and duplicated in at least [[https://bugs.php.net/bug.php?id=39915|39915]] and [[https://bugs.php.net/bug.php?id=72636|72636]].  PHP correctly returns a notice when you attempt to use an offset that is of an invalid type, PHP should also provide a notice when a container is of an invalid type.

===== Proposal =====
This RFC proposed to combine a couple of existing PR's[1][2] as well as my implementation to raise a E_NOTICE when a container type is used that does not contain array-accessable data.  The default behavior, of a silent NULL return, is not correctly defined in the [[http://php.net/manual/en/language.types.array.php|Array Documentation]] however is noted in a [[http://php.net/manual/en/language.types.array.php#111367|comment]]

As compared to the previous PR's (referenced below) this proposed implementation takes effort to limit throwing errors multiple times.

<file php>
<?php
$var = false;
$var[1][2][3][4][5]; // This will throw a single E_NOTICE, as accessing ($a[1])[2] 
                     // is attempting to access a IS_VAR chain that is NULL.
                     // Output would be:
                     // Notice: Variable of type boolean does not accept array offsets
$var = null;
list($a, $b) = $var;  // This will throw two E_NOTICE, as each assignment
                      // is an independent assignment to a CV.
                      // Output would be:
                      // Notice: Variable of type null does not accept array offsets
                      // Notice: Variable of type null does not accept array offsets
</file>

===== Backward Incompatible Changes =====
None

===== Proposed PHP Version(s) =====
Next PHP 7.x (currently 7.2)

===== RFC Impact =====
==== To SAPIs ====
No expected impact to SAPI's

==== To Existing Extensions ====
No Extensions

==== To Opcache ====
No Opcodes are touched with this RFC

===== Open Issues =====


===== Proposed Voting Choices =====
No syntax is changed, a vote of 50%+1 is necessary

<doodle title="E_NOTICE for invalid container array-access" auth="bp1222" voteType="single" closed="true">
   * Yes
   * No
</doodle>

===== Patches and Tests =====
[[https://github.com/php/php-src/pull/2031|RFC Proposed Implementation]]

===== Implementation =====
After the project is implemented, this section should contain 
  - the version(s) it was merged to
  - a link to the git commit(s)
  - a link to the PHP manual entry for the feature

===== References =====
==== Current Open PR's ====
[1] [[https://github.com/php/php-src/pull/866|PR 866]]

[2] [[https://github.com/php/php-src/pull/1269|PR 1269]]