====== PHP RFC: Union Types ======
  * Version: 0.1
  * Date: 2015-02-14
  * Author: Levi Morrison <levim@php.net>
  * Status: Draft
  * First Published at: http://wiki.php.net/rfc/union_types

===== Introduction =====
In PHP 5.1 the ability to provide explicit types for parameters was added to PHP. It supported classes, interfaces and arrays. In PHP 5.4 the ''callable'' pseudo-type was added. The ability to provide explicit return types was added in PHP 7 but did not allow returning something or null, a commonly requested feature. Later an RFC for adding explicit scalar types was proposed and a few people wanted to know why there isn't a ''numeric'' type to handle the case where ''int'' and ''float'' are both accepted. I have personally wanted the ability to type against both ''array'' and ''Traversable'' in some of my libraries.

All of these requests and discussions suggest that the ability to accept multiple types for a parameter or return type could be useful. This RFC is an investigation into the feasibility of this idea and to flesh out the impact it would have on other parts of PHP. 

===== Proposal =====
This RFC proposes the ability to define multiple possible types for a parameter or return type and calls them "union types". A value passes the type-check for a union type if the value would pass any one of the members the union.

Here is an example of a parameter accepting either an ''array'' or a ''Traversable'' and no other types:

<PHP>
function (array|Traversable $in) {
    foreach ($in as $value) {
        echo $value, PHP_EOL;
    }
}
</PHP>

===== Proposed PHP Version(s) =====
This RFC targets PHP version 7.1.

===== Open Issues =====
==== Weak Scalar Types ====
If PHP adds explicit weak scalar types there is a question of how things will get converted in some situations. As an example, if we have a union type of ''int'' and ''float'' and are passed the string "10" how is it converted?

<PHP>
function f(int|float $number) {
    return $number * 2;
}
f("10");
</PHP>

Would it be converted to ''int(10)'' or ''float(10)'', since either is acceptable? Does it matter given they are both acceptable?

This issue is avoided if a parameter type exactly matches the input type or if PHP is in strict type mode.

==== Reflection ====
There isn't any part of our current Reflection extension that can deal with union types. This will require some thought.

===== Future Scope =====
This sections details areas where the feature might be improved in future, but that are not currently proposed in this RFC.

==== Long Type Names ====
Since you can create a chain of types the names can get quite lengthy. Even the fairly short union type of ''array|Traversable'' can be repetitive to type out. Should a method to provide type aliases exist? It may be helpful to look at HHVM's [[http://docs.hhvm.com/manual/en/hack.typealiasing.php|Type Aliasing]].

==== Null ====

''Null'' is a type with a single value (also denoted as ''null''). Currently it is not possible to use ''null'' as a parameter or return type. I expect that one popular use of union types would be the ability to return some type or ''null''. This would require ''null'' to be allowed as an explicit type.

==== False ====

Peter Cowburn (salathe) has suggested that being able to explicitly use ''|false'' for return types could be helpful as this is a common idiom in PHP's standard functions. As an example, the function signature for ''strpos'' could change:

<PHP>// from
strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ): mixed
// to
strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ): int|false</PHP>

''false'' is not a type in user-land but it is internally. This is possible if we want to allow it.

===== Proposed Voting Choices =====
This RFC requires that two-thirds of voters vote in favor of the RFC to pass.

===== Patches and Tests =====
Presently no patch.

===== References =====
Links to external references, discussions or RFCs

===== Rejected Features =====
Keep this updated with features that were discussed on the mail lists.